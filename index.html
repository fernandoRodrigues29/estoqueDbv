<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/estilo.css">
    <link rel="stylesheet" href="./vendor/font-awesome-4.7.0/css/font-awesome.min.css">
    <script src="./vendor/js/bootstrap.min.js"></script>
    <!--para funcionar  modal -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <title>Estoque</title>
    <!--
        usar o bootsrap como estrutura
        e flexdesing como estilo personalizado
    -->
    <style>
        .lista-estoque
        {
            border: 1px solid #8f8a8a;
            box-shadow: 2px 3px #a3a4a4;
            padding: 18px;
            transition: 480ms;
            display: none;
        }
        .linha
        {
            border: 0px solid #1358a8;
            padding-bottom: 15px;
            margin-bottom: 1vh;
        }
        .item
        {
            border-bottom: 1px solid #777777;
            padding-bottom: 2px;    
        }

    </style>
</head>
<body>
    <main>
        <div class="container">
            <h1 class="text-center lead"> Estoque DBV </h1>
             <form action="" id="formulario">
                 <div class="row">
                     <div class="col-12 formulario-itens">
                         <input type="text" class="form-control" name="item" placeholder="o nome do Item" aria-label="Username" aria-describedby="basic-addon1">
                     </div>        
                 </div>
                 <div class="row">
                     <div class="col-12 formulario-itens">
                         <input type="number" class="form-control" name="quantidade" placeholder="Quantidade" aria-label="quantidade" aria-describedby="basic-addon1">
                     </div>  
                 </div>
                 <div class="row">
                     <div class="col-12 formulario-itens">
                         <span class="label">Descrição</span>
                         <textarea class="form-control" name="descricao" id=""></textarea>
                     </div>  
                 </div>
                 <div class="row">
                     <div class="col-12 formulario-itens">
                         <select class="form-control" name="status" id="">
                             <option value="presente">Presente no Estoque</option>
                             <option value="ausente">Ausente do estoque</option>
                         </select>
                     </div>  
                 </div>
                 <div class="row">
                     <div class="col-12">
                         <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="cs1">
                            <label class="custom-control-input" for="cs1"> Estado do Estoque</label>
                         </div>
                     </div>
                 </div>
                 
                 <div class="row">
                     <div class="col-12 formulario-itens">
                         <button type="submit" class="btn btn-block btn-info"> Salvar </button>
                     </div>
                 </div>
             </form> 
             <div class="lista-estoque">
                 <div class="row mb-1">
                     <div class='col-lg-2 col-12 text-center'><strong>TITULO</strong></div>
                     <div class='col-lg-2 col-12 text-center'><strong>DESC</strong></div>
                     <div class='col-lg-2 col-12 text-center'><strong>QTD</strong></div>
                     <div class='col-lg-2 col-12 text-center'><strong>STATUS</strong></div>
                     <div class='col-lg-2 col-12 text-center'><strong><i class="fa fa-pencil-square-o" aria-hidden="true" alt="EDITAR" title="EDITAR"></i></strong></div>
                     <div class='col-lg-2 col-12 text-center'><strong><i class="fa fa-trash-o" aria-hidden="true" alt="EXCLUIR" title="EXCLUIR"></i></strong></div>
                 </div>
                 <div class="conteudo">

                 </div>
             </div>  
        </div>
       
          
    </main>
    <!--modal-->
    <div class="modal fade" id="formularioEditar" tabindex="-1" role="dialog" aria-labelledby="formulario-editar" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="formulario-xeditar">Editar Item</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
               <div class="row">
                   <div class="col-12">
                    <span class="label">Nome</span>
                       <input type="text" class="form-control"  name="nome" id="m-nome" value="">
                   </div>
                   <div class="col-12">
                    <span class="label">quantidade</span>
                       <input type="text" class="form-control" name="quantidade" id="m-quantidade" value="">
                   </div>
                   <div class="col-12">
                        <span class="label">Descrição</span>
                        <textarea class="form-control" name="descricao" id="m-descricao" ></textarea>
                   </div>
                   
                   <div class="col-12">
                        <select class="form-control" name="status" id="m-status">
                            <option value="presente">Presente no Estoque</option>
                            <option value="ausente">Ausente do estoque</option>
                        </select>
                   </div>
               </div>     


            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
              <button type="button" onclick="atualizarItem()" class="btn btn-primary">Atualizar</button>
            </div>
          </div>
        </div>
      </div>
    <!--fim modal-->

    <script>
        var indice_geral = 0;
        let form = document.querySelector('#formulario');
        form.addEventListener('submit',(event) => {
            event.preventDefault();
              let dadoFormulario = new FormData(form);
                    let dadoEnviar =  {
                        titulo:dadoFormulario.get('item'),
                        quantidade:dadoFormulario.get('quantidade'),
                        descricao:dadoFormulario.get('descricao'),
                        status:dadoFormulario.get('status')
                    };
                   //enviar para localstorage
                   guardarDados(dadoEnviar);
                //    listarEstoque();      
               
        });
                
        var guardarDados = function(dados){
            if(localStorage.getItem('registro_do_estoque') == undefined || localStorage.getItem('registro_do_estoque') == null ){
                let arr = [];
                arr.push(dados);
                    localStorage.setItem('registro_do_estoque',JSON.stringify(arr));
                        listarEstoque();
            }else{
                let itens = localStorage.getItem('registro_do_estoque');
                    let arrItens = JSON.parse(itens);
                        console.log(' rsgatado ',arrItens);
                        arrItens.push(dados);
                        console.log(' pos add ',arrItens);
                            localStorage.setItem('registro_do_estoque',JSON.stringify(arrItens));
                            listarEstoque();
            }
            //.push
        }
        var listarEstoque = function()
        {
            //resgatar conteudo
            let continerLista = document.querySelector('.lista-estoque');
            let continerl = document.querySelector('.conteudo');
            
            if(localStorage.getItem('registro_do_estoque') != undefined || localStorage.getItem('registro_do_estoque') != null )
            {
                continerLista.style.display="block";
                continerl.style.display="block";
                //apagar contudo
                continerl.innerHTML = "";
                //
                let itens = localStorage.getItem('registro_do_estoque');
                let arrItens = JSON.parse(itens);
                  
                    arrItens.forEach((el,i) => {
                        var criar_elemento = document.createElement('div');
                            criar_elemento.className = "row mt-1 mb-1 linha";
                            
                            criar_elemento.innerHTML = "<div class='col-lg-2 col-12 item'>"+el.titulo+"</div>"+
                            "<div class='col-lg-2 col-12 item'>"+el.descricao+"</div>"+
                            "<div class='col-lg-2 col-12 item'>"+el.quantidade+"</div>"+
                            "<div class='col-lg-2 col-12 item'>"+el.status+"</div>"+
                            "<div class='col-lg-2 col-12 item'><button class='btn btn-info btn-block' data-toggle='modal' data-target='#formularioEditar'  onclick='formEditarItem("+i+")'><i class='fa fa-pencil-square-o' aria-hidden='true' alt='EDITAR' title='EDITAR' ></i></button></div>"+
                            "<div class='col-lg-2 col-12 item'><button class='btn btn-danger btn-block' onclick='excluirItem("+i+")'><i class='fa fa-trash-o' aria-hidden='true' alt='EXCLUIR' title='EXCLUIR'></i></button></div>"+
                            "";
                        
                                continerl.append(criar_elemento);
                                
                    });
            }
        }
        //editar item
        var formEditarItem = function(indice){
            indice_geral = indice;
            let itens = localStorage.getItem('registro_do_estoque');
            let arrItens = JSON.parse(itens);
            let rs = arrItens[indice];
                console.log('o idndice do estoque e ',arrItens[indice]);
                    
                    let fnome = document.querySelector('#m-nome');
                    let fqtd = document.querySelector('#m-quantidade');
                    let fdsc = document.querySelector('#m-descricao');
                    let fstatus = document.querySelector('#m-status');
                   
                        fnome.value = rs.titulo;
                        fqtd.value = rs.quantidade;
                        fdsc.value = rs.descricao;
                        fstatus.value = rs.status;
                    
        }

        var atualizarItem = function(){
            let modalWindow = document.querySelector('#formularioEditar');

            let itens = localStorage.getItem('registro_do_estoque');
            let arrItens = JSON.parse(itens);

            let rs = arrItens[indice_geral];
                    let fnome = document.querySelector('#m-nome');
                    let fqtd = document.querySelector('#m-quantidade');
                    let fdsc = document.querySelector('#m-descricao');
                    let fstatus = document.querySelector('#m-status');
                        
                    let obj  ={titulo: ""+fnome.value, 
                        quantidade: ""+fqtd.value,
                         descricao: ""+fdsc.value, 
                         status: ""+fstatus.value}
                        
                        arrItens[indice_geral] = obj;
                        
                            let sf = JSON.stringify(arrItens);
                            localStorage.setItem('registro_do_estoque',sf);
                                    listarEstoque();
                                    // modalWindow.style.display='none';
        }
        
        var excluirItem = function(indice){
            let itens = localStorage.getItem('registro_do_estoque');
            let arrItens = JSON.parse(itens);

                let novoArr = arrItens.splice(arrItens[indice], 1);
                    
                    let sf = JSON.stringify(novoArr);
                      localStorage.setItem('registro_do_estoque',sf);
                         alert('REGISTRO FOI REMOVIDO!');    
                        listarEstoque();

        }

        listarEstoque();
    </script>
</body>
</html>